\documentclass[9pt]{article}
\usepackage{geometry}
\geometry{
	a4paper,
	total={170mm,257mm},
	left=20mm,
	top=20mm,
}
% Required to make the margins smaller to fit more content on each page
\usepackage[linkcolor=blue]{hyperref} % Required to create hyperlinks to questions from elsewhere in the document
\hypersetup{pdfborder={0 0 0}, colorlinks=true, urlcolor=blue} % Specify a color for hyperlinks
\usepackage{tocloft} % Required to give customize the table of contents to display questions
\usepackage{microtype} % Slightly tweak font spacing for aesthetics
\usepackage{palatino} % Use the Palatino font
\usepackage{verbatim} 
\usepackage{makeidx}
\usepackage{xcolor}
\usepackage{amsmath,multirow}
% Uncomment the line below to get rid of the trailing dots in the table of contents
%\renewcommand{\cftdot}{}

% Uncomment the two lines below to get rid of the numbers in the table of contents
%\let\Contentsline\contentsline
%\renewcommand\contentsline[3]{\Contentsline{#1}{#2}{}}
\usepackage{marvosym}
\usepackage{fontawesome}
\usepackage{tipa}



\makeindex


\begin{document}

\title{\Huge{\textbf{Gas Accounting on \textsc{Zilliqa}}} \\ \small{[Draft version
0.1]}}

\author{
 	\href{https://www.zilliqa.com/team.html}{The \textsc{Zilliqa} Team} \\
    \Mundus~\href{https://www.zilliqa.com}{\texttt{www.zilliqa.com}}
\Letter~\href{mailto:enquiry@zilliqa.com}{\texttt{enquiry@zilliqa.com}}
\faTwitter~\href{https://twitter.com/zilliqa}{\texttt{@zilliqa}
}}


\maketitle

\section{Storage}

Gas consumed for storage (presented in \autoref{tab:storage}) depends on
the type of literal being stored. In the table below, $\ell$ denotes the
literal  and $litcost(\ell)$, the cost of storing it. Note that for certain
literal types such as \textbf{\texttt{\textcolor{teal}{Messsage}}},
\textbf{\texttt{\textcolor{teal}{Map}}} and
\textbf{\texttt{\textcolor{teal}{ADT}}}, $litcost(\ell)$ is recursively
computed. 


\begin{table}[!hbt]
	\caption{Storage cost in terms of gas for literals. \label{tab:storage} }
\centering
	\begin{tabular}{|p{3cm}|p{6.7cm}|p{6cm}|}
	\hline
		\textbf{Literal Type}  & \textbf{$litcost(\ell)$} & \textbf{Remarks} \\ \hline
	  	\textbf{\texttt{\textcolor{teal}{String}}}  & $$ 
	  	\begin{cases}
      20, & \text{if } len(\ell) \leq 20, \\
      len(\ell), & \text{else } \\
  \end{cases} $$ & $len(\cdot)$ computes the length of an input string, e.g.,
  		$len(\texttt{"Hello"})$ = 5.  \\ \hline
				\textbf{\texttt{\textcolor{teal}{Int32}}},
				\textbf{\texttt{\textcolor{teal}{Uint32}}}  & $4$
				& \multirow{4}{6cm}
				{Cost is the size of the integer in bytes.} \\ \cline{1-2} 
		\textbf{\texttt{\textcolor{teal}{Int64}}},
		\textbf{\texttt{\textcolor{teal}{Uint64}}}   & $8$ & \\ \cline{1-2}
		\textbf{\texttt{\textcolor{teal}{Int128}}},
		\textbf{\texttt{\textcolor{teal}{Uint128}}}   & $16$ &\\ \cline{1-2}
		\textbf{\texttt{\textcolor{teal}{Int256}}},
		\textbf{\texttt{\textcolor{teal}{Uint256}}}  & $32$ & \\ \hline
		\textbf{\texttt{\textcolor{teal}{BNum}}} &  $32$ & Internally represented as a
		256-bits unsigned integer. \textcolor{red}{Is this correct? } \\ \hline
		\textbf{\texttt{\textcolor{teal}{ByStrX}}}  & $width(\ell)$ & $width(\cdot)$ returns
		the number of bytes needed to represent the hexadecimal input, e.g.,
		$width(\texttt{0x1cd2}) = 2.$ \\ \hline
		\textbf{\texttt{\textcolor{teal}{ByStr}}}  & $len(\ell)-2$ & $len(\cdot)$ returns
		the length of the string representation of the input, e.g.,
		$len(\texttt{0x1cd2}) = 6. $ \textcolor{red}{So, the cost of ByStrX and ByStr is the
		same? ByStrX, ByStr and String should be comparable.} \\ \hline
		\textbf{\texttt{\textcolor{teal}{Messsage}}} 
		& For $\ell = \{s_1 : v_1; s_2 : v_2;
		\ldots, s_n : v_n\}$:
		$$ \begin{cases}
    		0, & \text{if } n = 0,  \\
    litcost(\{s_2 : v_2; \ldots, s_n : v_n\}) \\
    		 + litcost(s_1) + litcost(v_1), & 
    		\text{else } \\
  \end{cases}
		$$ & As a \textbf{\texttt{\textcolor{teal}{Messsage}}} literal is an associative array
		between a  \textbf{\texttt{\textcolor{teal}{String}}} literal (denoted $s_i$) and a
		value literal (denoted $v_i$), $litcost$
		is recursively computed by summing up over each $s_i : v_i$.
		\textcolor{red}{Base case is incorrect.}   \\ \hline
		\textbf{\texttt{\textcolor{teal}{Map}}} &
		For $\ell = \{(k_1 \rightarrow v_1), 
		\ldots, (k_n \rightarrow v_n)\}$:
		$$ \begin{cases}
    		0, & \text{if } n = 0,  \\
  			\sum_{(k \rightarrow v) \in \ell} {litcost(k) + litcost(v)},  &
    		\text{else } \\
  \end{cases}
		$$ & As a \textbf{\texttt{\textcolor{teal}{Map}}} literal maps a key literal ($k_i$) to a
		value literal ($v_i$),  $litcost$
		is recursively computed by summing up over each $(k_i \rightarrow v_i)$. \textcolor{red}{Base case is incorrect.} \\ \hline
		\textbf{\texttt{\textcolor{teal}{ADT}}} (e.g.,
		\textbf{\textcolor{magenta}{\texttt{Bool}}},
		\textbf{\textcolor{magenta}{\texttt{Option}}},
		\textbf{\textcolor{magenta}{\texttt{List}}}) & For $\ell = \texttt{cname}\;
		\{\texttt{types}\} \; t_1 t_2 \ldots t_n $:
		$$ \begin{cases}
    		0, & \text{if } n = 0,  \\
  			\sum_{i} {litcost(t_i)},  &
    		\text{else } \\
  		\end{cases}
		$$ 
		
		& An \textbf{\texttt{\textcolor{teal}{ADT}}} literal takes a constructor name
		(\texttt{cname}), types of the arguments (\texttt{types}) and arguments
		denoted by $t_1, t_2, \ldots, t_n$. $litcost$ is recursively computed
		by summing up the cost over each $t_i$. \textcolor{red}{Base case is incorrect.} \\ \hline
	\end{tabular}
	\end{table}
 
\section{Computation}

In this section, we present the cost of performing computations in a contract
using \textsc{Scilla} \emph{expressions}. Expressions handle purely
mathematical computations and do not have any side-effects. 

Cost of a computation via an expression can be divided into two parts: the
static cost associated with employing a specific expression and the dynamic
cost that takes into account the cost that can only be estimated at run time.
Some expressions do not entail any dynamic cost.

\subsection{Static Cost for Expressions}

Every expression has a static cost associated with it.
\autoref{tab:expressions} lists the cost of each expression supported in
\textsc{Scilla}. In the table below, $e$ denotes the expression and
$statcost(e)$ the static cost associated with using $e$.

\begin{table}[!hbt]
	\caption{Gas consumed for expressions. \label{tab:expressions} }
\centering
	\begin{tabular}{|c|c|p{8.5cm}|}
	\hline
		\textbf{Expression} & \textbf{$statcost(e)$} & \textbf{Remarks} \\ \hline
		\textbf{\texttt{\textcolor{teal}{Literal}}}  & \multirow{9}{*}{1}  & \\
		\cline{1-1} \cline{3-3}
		\textbf{\texttt{\textcolor{teal}{Var}}}  &  & \\ \cline{1-1}\cline{3-3}

		\textbf{\texttt{\textcolor{teal}{Let}}}  &  & \\ \cline{1-1}\cline{3-3}

		\textbf{\texttt{\textcolor{teal}{Message}}}  &  & \\ \cline{1-1}\cline{3-3}
		\textbf{\texttt{\textcolor{teal}{Fun}}}  &  & A function declaration, e.g., \texttt{\textbf{\textcolor{violet}{fun}} (x : \textbf{\textcolor{orange}{T}}) => e}. \\ \cline{1-1} \cline{3-3}
		\textbf{\texttt{\textcolor{teal}{App}}}  &  & A function application, e.g.,
			\texttt{\textbf{\textcolor{violet}{f}} <x\_i>}. \\ \cline{1-1}\cline{3-3}

			\textbf{\texttt{\textcolor{teal}{TFun}}}  &  & A type function of
			the form: \texttt{\textbf{\textcolor{violet}{tfun}} $\alpha$ => e}. \\ \cline{1-1}\cline{3-3}

			\textbf{\texttt{\textcolor{teal}{TApp}}}  &  & A type
			instantiation: \texttt{\textbf{\textcolor{violet}{@}}x
			\textbf{\textcolor{orange}{T}}}. \\ \cline{1-1}\cline{3-3}

			\textbf{\texttt{\textcolor{teal}{Constr}}}  &  & Constructors. \\ \hline
			\textbf{\texttt{\textcolor{teal}{MatchExpr}}}  & $nbClauses(e)$
		&$nbClauses(\cdot)$ returns the number of clauses in the pattern match.
		 \\ \hline
	   \textbf{\texttt{\textcolor{teal}{Fixpoint}}}  & 1  & Rest of the cost is
		accounted during recursive evaluation. \\ \hline
		\textbf{\texttt{\textcolor{teal}{Builtin}}}  & 0 & Purely dynamic cost. \\ \hline
	\end{tabular}
	\end{table}
 

\subsection{Executing Statements}

State changes and other operations that entail side-effects such as reading the
current state of the blockchain or invoking message calls to other contracts
are performed via \textsc{Scilla} \emph{statements}. \autoref{tab:statements}
presents the gas consumed for statements.

\begin{table}[!hbt]
	\caption{Gas for statements. \label{tab:statements} }
\centering
	\begin{tabular}{|l|p{8cm}|p{3cm}|}
	\hline
		\textbf{Statement $(l)$} & \textbf{$Cost(l)$} & \textbf{Remarks} \\ \hline
		\texttt{\textcolor{teal}{G\_Load}}  & $cost(l)$  & \\ \hline
		\texttt{\textcolor{teal}{G\_Store}}  & $\max\{cost(l_{old}),
		cost(l_{new})\} + cost(l_{new}) -
		cost(l_{new})$  & \\ \hline
		\texttt{\textcolor{teal}{G\_Bind}}  & 1 & \\ \hline
		\texttt{\textcolor{teal}{G\_MatchStmt}}  & $nbclauses(l)$  & \\ \hline
		\texttt{\textcolor{teal}{G\_ReadFromBC}}  & 1  & \\ \hline
		\texttt{\textcolor{teal}{G\_AcceptPayment}}  & 1  & \\ \hline
		\texttt{\textcolor{teal}{G\_SendMsgs}}  & For $t = [\{s_{1}^{1} :
		v_{1}^{1}; \ldots, s_n^1 : v_n^1\}, \{s_1^2 : v_1^2; \ldots, s_n^2 :
		v_n^2\}, \ldots, \{s_1^m : v_1^m; \ldots, s_n^2 : v_n^m\}] $: $$
		\sum_{\ell \in t} cost(l) $$ & \\ \hline
		\texttt{\textcolor{teal}{G\_CreateEvent}}  & $cost(e)$ & \\ \hline
	\end{tabular}
\end{table}


\subsection{Builtins}

\begin{table}[!hbt]
	\caption{Dynamic cost for String Builtins. \label{tab:string_builtins} }
\centering
	\begin{tabular}{|c|p{4.1cm}|c|p{5cm}|}
	\hline
		\textbf{Category} & \textbf{Operation} & \textbf{$Cost(op)$} & \textbf{Remarks} \\ \hline
		\multirow{3}{*}{\texttt{\textcolor{teal}{String}}} & \texttt{\textcolor{magenta}{eq}} & $cost(l)$  & \\
		\cline{2-4}
		 & \texttt{\textcolor{magenta}{concat}} & $cost(l)$  & \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{substr}} & $cost(l)$  & \\ \hline \hline
		\multirow{5}{*}{\texttt{\textcolor{teal}{Hashing}}} &
		  \texttt{\textcolor{magenta}{eq}} & $ width(a) $  & $width(\cdot)$
		  returns the size in number of bytes of the inputs. Note that the
		  operator expects two inputs of the same size.  \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{dist}} & $32$  & \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{ripemd160hash}} & $cost(l)$  & \\
		\cline{2-4}
		 & \texttt{\textcolor{magenta}{sha256hash}} & $cost(l)$  & \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{keccak256hash}} & $cost(l)$  & \\ \hline
		 \hline
		\multirow{4}{*}{\texttt{\textcolor{teal}{Signing}}} &
		\texttt{\textcolor{magenta}{schnorr\_gen\_key\_pair}} & $cost(l)$  & \\
		\cline{2-4}
		 & \texttt{\textcolor{magenta}{schnorr\_sign}} & $cost(l)$  & \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{schnorr\_verify}} & $cost(l)$  & \\
		 \cline{2-4}
		 & \texttt{\textcolor{magenta}{to\_bystr}} & $width(a)$  & $width(\cdot)$
		 returns
		 the number of
		 bytes represented
		 by the input.\\ \hline
		 \hline
		\multirow{6}{*}{\texttt{\textcolor{teal}{Map}}} &
		\texttt{\textcolor{magenta}{contains}} & $cost(l)$  & \\
		\cline{2-4}
		 & \texttt{\textcolor{magenta}{put}} & $cost(l)$  & \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{get}} & $cost(l)$  & \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{remove}} & $cost(l)$  & \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{to\_list}} & $cost(l)$  & \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{size}} & $cost(l)$  & \\ \hline \hline
		\multirow{4}{*}{\texttt{\textcolor{teal}{Nat}}} &
		\texttt{\textcolor{magenta}{}} & $cost(l)$  & \\
		\cline{2-4}
		 & \texttt{\textcolor{magenta}{}} & $cost(l)$  & \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{}} & $cost(l)$  & \\ \hline \hline
		\multirow{4}{*}{\texttt{\textcolor{teal}{Int32}},
		\texttt{\textcolor{teal}{Uint32}}} & \texttt{\textcolor{magenta}{mul}},
		 \texttt{\textcolor{magenta}{div}}, \texttt{\textcolor{magenta}{rem}} &
		 $ 20  $  & \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{eq}}, \texttt{\textcolor{magenta}{lt}},
		 \texttt{\textcolor{magenta}{add}}, \texttt{\textcolor{magenta}{sub}},
		 \texttt{\textcolor{magenta}{to\_int32}},
		 \texttt{\textcolor{magenta}{to\_uint32}},
		 \texttt{\textcolor{magenta}{to\_int64}},
		 \texttt{\textcolor{magenta}{to\_uint64}},
		 \texttt{\textcolor{magenta}{to\_int128}},
		 \texttt{\textcolor{magenta}{to\_uint128}},
		 \texttt{\textcolor{magenta}{to\_int256}},
		 \texttt{\textcolor{magenta}{to\_uint256}},
		 \texttt{\textcolor{magenta}{to\_nat}}
		 & $4$  & \\ \hline \hline
		\multirow{4}{*}{\texttt{\textcolor{teal}{Int64}},
		\texttt{\textcolor{teal}{Uint64}}} &
		\texttt{\textcolor{magenta}{mul}},
		 \texttt{\textcolor{magenta}{div}}, \texttt{\textcolor{magenta}{rem}} &
		 $ 20 $  & \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{eq}}, \texttt{\textcolor{magenta}{lt}},
		 \texttt{\textcolor{magenta}{add}}, \texttt{\textcolor{magenta}{sub}},
		 \texttt{\textcolor{magenta}{to\_int32}},
		 \texttt{\textcolor{magenta}{to\_uint32}},
		 \texttt{\textcolor{magenta}{to\_int64}},
		 \texttt{\textcolor{magenta}{to\_uint64}},
		 \texttt{\textcolor{magenta}{to\_int128}},
		 \texttt{\textcolor{magenta}{to\_uint128}},
		 \texttt{\textcolor{magenta}{to\_int256}},
		 \texttt{\textcolor{magenta}{to\_uint256}},
		 \texttt{\textcolor{magenta}{to\_nat}}
		 & $4$  & \\ \hline \hline
		\multirow{4}{*}{\texttt{\textcolor{teal}{Int128}},
		\texttt{\textcolor{teal}{Uint128}}} &
		\texttt{\textcolor{magenta}{mul}},
		 \texttt{\textcolor{magenta}{div}}, \texttt{\textcolor{magenta}{rem}} &
		 $ 40 $  & \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{eq}}, \texttt{\textcolor{magenta}{lt}},
		 \texttt{\textcolor{magenta}{add}}, \texttt{\textcolor{magenta}{sub}},
		 \texttt{\textcolor{magenta}{to\_int32}},
		 \texttt{\textcolor{magenta}{to\_uint32}},
		 \texttt{\textcolor{magenta}{to\_int64}},
		 \texttt{\textcolor{magenta}{to\_uint64}},
		 \texttt{\textcolor{magenta}{to\_int128}},
		 \texttt{\textcolor{magenta}{to\_uint128}},
		 \texttt{\textcolor{magenta}{to\_int256}},
		 \texttt{\textcolor{magenta}{to\_uint256}},
		 \texttt{\textcolor{magenta}{to\_nat}}
		 & $8$  & \\ \hline \hline
		\multirow{4}{*}{\texttt{\textcolor{teal}{Int256}},
		\texttt{\textcolor{teal}{Uint256}}} &
		\texttt{\textcolor{magenta}{mul}},
		 \texttt{\textcolor{magenta}{div}}, \texttt{\textcolor{magenta}{rem}} &
		 $ 80 $  & \\ \cline{2-4}
		 & \texttt{\textcolor{magenta}{eq}}, \texttt{\textcolor{magenta}{lt}},
		 \texttt{\textcolor{magenta}{add}}, \texttt{\textcolor{magenta}{sub}},
		 \texttt{\textcolor{magenta}{to\_int32}},
		 \texttt{\textcolor{magenta}{to\_uint32}},
		 \texttt{\textcolor{magenta}{to\_int64}},
		 \texttt{\textcolor{magenta}{to\_uint64}},
		 \texttt{\textcolor{magenta}{to\_int128}},
		 \texttt{\textcolor{magenta}{to\_uint128}},
		 \texttt{\textcolor{magenta}{to\_int256}},
		 \texttt{\textcolor{magenta}{to\_uint256}},
		 \texttt{\textcolor{magenta}{to\_nat}}
		 & $ 16 $  & \\ \hline \hline
		\texttt{\textcolor{teal}{BNum}} &
		\texttt{\textcolor{magenta}{eq}}, \texttt{\textcolor{magenta}{blt}},
		\texttt{\textcolor{magenta}{badd}} & 4  & \\ \hline 
	\end{tabular}
\end{table}



%\section{Contract Deployment}

%\section{Importing Standard Libraries}

\end{document}
